<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>
    <title>Document</title>
</head>
<body>




    <nav id="nav" class="navbar nav px-5">
        <div>
            <img style="width: 3rem;" src="/images/logo/OIP (4).jpg" alt="">
        </div>
    
        </div>
       
        <form action="/admin/logouttt" method="get">
            <button type="submit" class="btn btn-warning">Logout</button>
        </form>
        </div>
    
        <h4>Admin Panel</h4>
    
    </nav>
    
    <section>
        <div class="container-fluid px-5 py-3">
            <div class="row sidebar col-md3">
                <div class="heading fw-bold h4 text-center pt-1 text-second">
                    Admin Pannel
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/admin/admin-ho"><i
                            class="fa-solid fa-layer-group"><span class="blue-secondary px-2">Dashboard</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/products/view-products"><i
                            class="fa-solid fa-box-open"><span class="blue-secondary px-2">Products</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/admin/dashboard"><i class="fa-solid fa-user"><span
                                class="blue-secondary px-2">Customers</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/admin/orders"><i
                            class="fa-solid fa-cart-shopping"><span class="blue-secondary px-2">Orders</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/categories/view-category"><i
                            class="fa-solid fa-table-cells-large"><span class="blue-secondary px-2">Category</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="//banner"><i class="fa-solid fa-flag"><span
                                class="blue-secondary px-2">Banner Manage</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/coupen"><i
                            class="fa-solid fa-money-bill-wave"><span class="blue-secondary px-2">Manage
                                Coupen</span></i></a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/sales-report/sales">
                        <i class="fa-solid fa-file-export"><span class="blue-secondary px-2">Sales Report</span></i>
                    </a>
                </div>
                <div class="blue-secondary px-3 py-2">
                    <a style="text-decoration:none; color:#0066B0" href="/admin/return">
                        <i class="fa-solid fa-bell"><span class="blue-secondary px-2">Return Requests</span></i>
                    </a>
                </div>
            </div>
        </div>
    </section>
    
    
    <style>
        :root{
      --background:rgba(211, 219, 238, 1);
      --buttonColor:#50a088;
      --textcolor: #0066B0;
      }
      .nav{
      background-color: var(--background)
      }
      
      .sidebar {
      width: 15rem;
      border-radius: 0.375rem;
      background: #FFF;
      box-shadow: 2px 2px 10px 2px rgba(124, 124, 124, 0.25);
      }
      
      .heading {
      width: 100%;
      height: 2.6875rem;
      border-radius: 0.375rem 0.375rem 0rem 0rem;
      background: #D3DBEE;
      }
      .user-btn{
      background-color: var(--buttonColor) !important;
      color: #FFF !important;
      cursor: pointer !important;
      }
      .clear-btn{
      background-color: var(--background) !important;
      cursor: pointer !important;
      }
      .user-text{
      color: var(--buttonColor) !important;
      font-family: roboto;
      font-size: 1.2rem;
      }
      .user-icon{
      color:var(--textcolor) !important ;
      }
      
          
      
      </style>

<section style="width: 100vw;margin-top: -30%;margin-left: 22%;" class="category d-flex">
    <div class="object-fit-contain mt-3">
        <div class="header d-flex py-3 justify-content-between">
            <h3 class="h3 text-second fw-bold mb-3">Sales Report</h3>
            <div class="file">
                <span style="cursor: pointer;" class="fw-bold text-second filter-show">Filter <i
                        class="fa-solid fa-filter"></i></span>
                <button id="exportToButton" class="btn  add-btn">Download Pdf</button>
            </div>
        </div>
        <form method="post" action="/admin/sales-report/filter">
            <div class="filterDiv card py-3 px-2 my-2">
                <div class="d-flex align-items-center justify-content-around">
                    <div class="iputs">
                        <label class="me-2" for="">Date From</label>
                        <input style="width: 10rem;" class="form-control " type="date" name="from" id="">
                    </div>
                    <div class="iputs">
                        <label class="ms-2" for="">Date To</label>
                        <input style="width: 10rem;" class="form-control ms-2 " type="date" name="to" id="">
                    </div>
                    <div class="iputs">
                        <label for="exampleFormControlSelect1">Payment Method</label>
                        <select class="form-select" name="payment_method" id="exampleFormControlSelect1">
                            <option>All</option>
                            <option>COD</option>
                            <option>Online Payment</option>
                        </select>
                    </div>
                </div>
                <input type="submit" id="filterSubmit" value="Filter" class="btn mt-3 add-btn rounded">
            </div>
        </form>
        <table style="width: 100%;" id="exportToTable" class="table table-striped table-bordered table-sm"
            cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="th-sm">Customer</th>
                    <th class="th-sm">Product_Name</th>
                    <th class="th-sm">Ordered_Date</th>
                    <th class="th-sm">Delivered_Date</th>
                    <th class="th-sm">Quantity</th>
                    <th class="th-sm">Category</th>
                    <th class="th-sm">Payment</th>
                    <th class="th-sm">Amount</th>
                </tr>
            </thead>
            <tbody>
                <% salesReport.forEach(function(sale) { %>
                    <tr>
                        <td><%= sale.user.name %> </td>
                        <td><%= sale.product.name %></td>
                        <td><%= sale.createdAt %></td>
                        <td><%= sale.items.delivered_on %></td>
                        <td><%= sale.items.quantity %></td>
                        <td><%= sale.category.name %></td>
                        <td><%= sale.payment_method %></td>
                        <td><%= sale.items.price %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</section>

    
    <script>
        $(document).ready(() => {
        new DataTable('#exportToTable');
        $('.filterDiv').hide();
        $('.filter-show').on('click', () => {
            $('.filterDiv').slideToggle();
        })
    
        //pdf download
        $("#exportToButton").click(function () {
            Swal.fire({
                title: 'Are you sure',
                text: "Are you want to download sales Report",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#D3DBEE',
                confirmButtonText: 'Download'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        'Downloading..',
                        'Your file is being downloadig.',
                        'success'
                    ).then(() => {
                        const dataSource = shield.DataSource.create({
                            data: "#exportToTable",
                            schema: {
                                type: "table",
                                fields: {
                                    Customer: { type: String },
                                    Product_Name: { type: String },
                                    Ordered_Date: { type: String },
                                    Delivered_Date: { type: String },
                                    Quantity: { type: String },
                                    Category: { type: String },
                                    Payment: { type: String },
                                    Amount: { type: Number }
                                }
                            }
                        });
    
                        dataSource.read().then(function (data) {
                            var pdf = new shield.exp.PDFDocument({
                                author: "EC-Shop",
                                created: new Date()
                            });
                            pdf.addPage("a4", "landscape");
                            pdf.table(
                                50,
                                50,
                                data,
                                [
                                    { field: "Customer", title: "Customer", width: 70 },
                                    { field: "Product_Name", title: "Product Name", width: 100 },
                                    { field: "Ordered_Date", title: "Ordered Date", width: 100 },
                                    { field: "Delivered_Date", title: "Delivered Date", width: 100 },
                                    { field: "Quantity", title: "Quantity", width: 70 },
                                    { field: "Category", title: "Category", width: 100 },
                                    { field: "Payment", title: "Payment", width: 100 },
                                    { field: "Amount", title: "Amount", width: 70 },
    
                                ],
                                {
                                    margins: {
                                        top: 50
                                    }
                                }
                            );
    
                            pdf.saveAs({
                                fileName: "SalesReport"
                            });
                        });
                    })
                }
    
            })
        });
    });
    </script>
</body>
</html>

