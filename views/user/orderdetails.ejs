<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <!-- Add these lines in the head section of your HTML file -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Include SweetAlert CSS and JS files -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <!-- Add these lines in the head section of your HTML file -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Add these lines in the head section of your HTML file -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- Include SweetAlert CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
  <!-- Add this to your HTML -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" integrity="...">

  <!-- Bootstrap JavaScript and dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="..."></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="..."></script>


  <!-- Your other HTML head content -->

  <!-- Include SweetAlert JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <!-- Add these lines in the head section of your HTML file -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


  <title>Document</title>
</head>

<body>




  <style>
    :root {
      --background: rgb(241, 242, 245);
      --text-color: rgba(0, 102, 176, 1);
      --white: rgb(106, 243, 143);
      --user-backhround: rgba(107, 199, 171, 1);
    }

    .blue-secondary {
      color: var(--text-color);
      font-size: 1.2rem;
      font-family: Roboto;
    }

    .button-cancel {
      background-color: var(--background) !important;
    }

    .add-btn {
      background-color: var(--text-color) !important;
      color: var(--white) !important;
      cursor: pointer !important;
    }

    .text-second {
      color: var(--text-color) !important;
    }

    .ladels a {
      text-decoration: none;
      color: var(--text-color);
    }

    .search a {
      color: var(--text-color);
      font-size: 1.5rem;
    }


    .user-nav {
      position: sticky;
      top: 0;
      z-index: 4;
      background-color: var(--white);
    }

    .search-box {
      background-color: var(--background);
      border-radius: 5px;
      width: 20rem;
      border: none;
      padding: 5px;
      outline: var(--text-color);
    }

    .prof-div {
      z-index: 6;
      right: 4.5rem;
      top: 3rem;
    }

    .account,
    .account a {
      background: var(--user-backhround);
      color: var(--white) !important;
      text-decoration: none !important;
    }

    .image-container {
      width: 500px;
      height: 500px;
      position: relative;
      overflow: hidden;
    }

    #primary-img-view {
      width: fit-content;
      min-width: 200px;
      position: absolute;
      left: 50%;
      right: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    .add-to-wish-list-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 25px;
      z-index: 2;
    }

    .wallet-history {
      max-height: 170px;
      overflow-y: scroll;
      padding: 10px;
    }

    .wallet-history::-webkit-scrollbar {
      width: 7px;
      background-color: rgb(173, 173, 173);
      border-radius: 10px;
    }

    .wallet-history::-webkit-scrollbar-thumb {
      background: #2d6b5e;
      border-radius: 10px;
    }
  </style>
  <%- include('../partials/user-header.ejs') %>

    <script>

      $(document).ready(function () {
        $("#btnn").click(function () {
          $("#prof-div").toggle();
        });
      });

    </script>
    <div style="width: 100%; position: relative;margin-top:10%; margin-left: 13%;" class="container-fluid ">
      <% orderDetails.forEach(order=> { %>
        <div class="card px-4 my-2 order-details col-md-9" style="background-color:#07ae5d">
          <div class="img-text-wrapper p-3 d-flex">
            <img style="width: 5rem;" src="/images/product/<%= order.products.productImages[0]%>" alt="">
            <div class="h5 fw-bold">
              <%= order.products.name %>
                <span style="font-size: 0.9rem;" class="fw-normal"><br> Quantity:<%= order.items.quantity %></span>
                <span style="font-size: 0.9rem; color: white;" class="fw-bold">

                  &nbsp &nbsp &nbsp &#160 â‚¹<%= order.products.offers?.[0]?.discountedPrice || order.items.price %>
                </span>
            </div>


            <% if (order.items.delivered) { %>
              <div style="width:60%; height:1rem" class="d-flex align-items-center justify-content-end">
                <i class="fa-solid text-success fa-star"></i>
                <i class="fa-solid text-success fa-star"></i>
                <i class="fa-regular text-secondary fa-star"></i>
                <a href="/reviews/new-review/<%= order.products._id %>" class="text-decoration-none text-success">
                  Rate this?
                </a>
              </div>
              <% } %>
          </div>
          <div style="width:100%; z-index:1;" class="d-flex justify-content-around mb-3">
            <% if (order.items.cancelled) { %>
              <input role="button" readonly type="none" class="text-center btn bg-light text-danger py-2 px-2"
                value="Cancelled">
              <% } %>
                <% if (order.items.ordered) { %>
                  <input role="button" onclick="cancelOrder('<%=order.items.product_id%>','<%= order._id %>')" readonly
                    type="none" class="text-center btn bg-light text-primary py-2 px-2" value="Cancel">
                  <% } %>
                    <input role="button" id="cancel-btn" onclick="trckOrder('<%= order.items._id %>')" readonly
                      type="none" class="text-center btn bg-light text-primary py-2 px-2" value="Track Order">
                    <% if (order.items.return) { %>
                      <a class="text-decoration-none"
                        href="/order/return-order?order_id=<%= order._id %>&product_id=<%= order.items.product_id %>">
                        <input role="button" readonly type="none"
                          class="text-center btn bg-light text-primary py-2 px-2" value="Return?">
                      </a>
                      <% } %>
                        <% if (order.items.inReturn) { %>
                          <input role="button" readonly type="none"
                            class="text-center btn bg-secondary text-warning py-2 px-2"
                            value="Return: <%= order.items.status %>">
                          <% } %>
                            <% if (order.items.needHelp) { %>
                              <input role="button" readonly type="none"
                                class="text-center btn bg-light text-primary py-2 px-2" value="Need Help?">
                              <% } %>
                                <% if (order.items.delivered) { %>
                                  <a href="/order/get-invoice?productId=<%= order.items.product_id %>&orderId=<%= order._id %>"
                                    class="text-center btn bg-light text-primary text-decoration-none py-2 px-4">
                                    <i class="fa-solid fa-download"></i> Download Invoice
                                  </a>
                                  <% } %>
          </div>
          <div class="row d-flex align-items-center">
            <div style="position: relative;" id="order<%= order.items._id %>"
              class="border track-order my-2 p-2 rounded ">
              <% if (order.items.cancelled_on) { %>
                <div style="width:98% ; position:absolute;top:4rem ;height:1.5rem"
                  class="bg-light text-center fw-bold text-danger">
                  Cancelled on <%= toDateAndTime(order.items.cancelled_on) %>
                </div>
                <% } %>
                  <% if (order.items.pending) { %>
                    <div style="width:98% ; position:absolute;height:1.5rem"
                      class="bg-light text-center fw-bold text-danger">
                      Payment Failed
                    </div>
                    <% } %>
                      <div class="d-flex justify-content-around mb-1">
                        <div style="width: 10rem;">
                          <p class="text-muted mt-1 mb-0 small ms-xl-5">
                            <%= toDateAndTime(order.createdAt) %>
                          </p>
                        </div>
                        <div style="width: 10rem;">
                          <% if (order.items.shipped) { %>
                            <p class="text-muted mt-1 mb-0 small ms-xl-5">
                              <%= toDateAndTime(order.items.shipped_on) %>
                            </p>
                            <% } %>
                        </div>
                        <div style="width: 10rem;">
                          <% if (order.items.outdelivery) { %>
                            <p class="text-muted mt-1 mb-0 small ms-xl-5">
                              <%= toDateAndTime(order.items.out_for_delivery) %>
                            </p>
                            <% } %>
                        </div>
                        <div style="width: 10rem;">
                          <% if (order.items.delivered) { %>
                            <p class="text-muted mt-1 mb-0 small ms-xl-5">
                              <%= toDateAndTime(order.items.delivered_on) %>
                            </p>
                            <% } %>
                        </div>
                      </div>
                      <div class="progress" style="height: 6px; border-radius: 16px;">
                        <div class="progress-bar" role="progressbar"
                          style="width: <%= order.items.track %>%; border-radius: 16px; <%= order.items.cancelled_on ? 'background-color: black;' : 'background-color:black;' %>"
                          aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">
                        </div>
                        <div class="d-flex justify-content-around mb-1">
                          <p class="text-muted fw-bold mt-1 mb-0 small ms-xl-5">Ordered</p>
                          <p class="text-muted fw-bold mt-1 mb-0 small ms-xl-5">Shipped</p>
                          <p class="text-muted fw-bold mt-1 mb-0 small ms-xl-5">Out for delivery</p>
                          <p class="text-muted fw-bold mt-1 mb-0 small ms-xl-5">Delivered</p>
                        </div>
                      </div>
            </div>
          </div>
        </div>

        <% function toDateAndTime(date) { %>
          <% // Your implementation of toDateAndTime function, for example: %>
            <% const formattedDate=new Date(date).toLocaleString(); %>
              <% return formattedDate; %>
                <% } %>
                  <% }); %>
    </div>

    <script>
      function cancelOrder(product_id, order_id) {
        Swal.fire({
          title: "Are you sure?",
          text: "Are you sure you want to cancel this order?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#0061bc",
          cancelButtonColor: "rgb(128, 128, 128)",
          confirmButtonText: "Yes, cancel it!",
        }).then(async (result) => {
          if (result.isConfirmed) {
            await fetch(`/order/cancel_order/${product_id}/${order_id}`, {
              method: 'GET',
            }).then(response => response.json())
              .then(data => {
                if (data.success) {
                  Swal.fire(
                    'Cancelled!',
                    'Product cancelled successfully',
                    'success'
                  ).then(() => {
                    location.reload(true);
                  });

                }
              });
          }
        });
      }
    </script>
    <script>
      $(document).ready(() => {
        $('.track-order').hide();
        trckOrder = (id) => {
          $(`#order${id}`).slideToggle();
        }
      })



    </script>





</body>

</html>